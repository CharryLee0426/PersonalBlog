## <center>计算机安全导论大作业：关于条形码和二维码的研究</center>

| 姓名 | 学号        |
| ---- | ----------- |
| 李晨 | 19030100104 |

### 1. 背景研究

​		生活中我们无时无刻不在和条形码、二维码打交道。我们在超市买菜，图书馆借书，收取快递，以及日常大部分生活中的支付都要用到条形码、二维码，可以说，条形码和二维码是现代互联网的一个重要入口。由于中国的信用卡业务发展缓慢，而智能手机业务发展迅速，使得在中国，以微信支付、支付宝为代表的二维码支付打败了技术上更先进的 NFC 支付。2017 年，腾讯推出了微信小程序，而在发布初期，微信产品经理张小龙并未开启小程序搜索功能，仅提供通过二维码访问小程序的功能，足以可见条码、二维码在互联网中的重要作用。这篇文章详细讨论了条形码、二维码的标准、编码、和识别、纠错的相关问题。

#### 1.1 条形码

​		条形码（Barcode）是将宽度不等的多个黑条和空白（事实上也可以是两种反射率相差较大的颜色，只要能够符合扫描器的分辨标准即可）按照一定的编码规则排列，用于表达一组信息的图形标识符。条形码的诞生时间相当早，不过早期的条形码与现在见到的很不一样。1949年，美国人 Norman Joseph Woodland 和 Bernard Silver 申请了用于食品自动识别领域的环形条形码，因为它的形状像一只眼睛，也被称作“公牛眼”。经过几十年的发展，世界各国都广泛采用了条形码作为识别商品、邮政等的标准工具。对于条形码，国际标准组织（ISO）制定了标准 ISO 15416 规定条形码可选的制式、编码标准、扫描器的解码标准等一系列标准。由各国组成的 ISO 和 IEC 会共同定期修订该标准，最新的版本为 ISO 15416-2016。

![一张符合标准的二维码](https://pic.imgdb.cn/item/61c236582ab3f51d91df9ce8.png)

#### 1.2 二维码

​		二维码亦称为二维条码，是指在一维条码的基础上拓展出另一维具有可读性的条码，使用颜色反射率较大的两种颜色填充矩形图案表示二进制数据。二维码被认为是对 Barcode 能力的一种拓展，所以 Barcode 又被称作“一维条码”。简单说来，二维码相较于一维码，拥有了“定位点”和“容错机制”，该容错机制在即使没有识别到全部条码，或者说条码有污损的情况下依旧能够正确读取到条码的所有信息。现如今生活的方方面面都离不开二维码，尤其在中国，二维码支付方式处于绝对的统治地位。同样，国际标准组织 ISO 也为二维码制定了国际标准 ISO 18004，最新版本 ISO 18004-2015。事实上，我们这里所指的二维码，是指二维码范围下的 QR Code，全称为“Quick Response Code”，快速响应码，特点是有在图形的左上、右上、左下角有三个较大的方块，在右下角有一个较小的方块。

![](https://pic.imgdb.cn/item/61c236732ab3f51d91dfaca4.png)

### 2. 编码标准

#### 2.1 条形码

条形码发展较早，所以条形码的编码标准也有很多，这里列举几种常见的编码标准。

| 编码标准 | 简介                                                   |
| -------- | ------------------------------------------------------ |
| CODE 39  | 不固定长度，可表示43个字元                             |
| CODE 93  | CODE 39 的改进版本，使用较少                           |
| CODE 128 | 不固定长度，可表示 ASCII 规定的全部字符                |
| EAN_8    | 8 位欧洲商品条码，只表示数字，成为了全球商品交易的标准 |
| EAN_13   | 13 位欧洲商品条码。                                    |
| CODABAR  | 图书馆和血库使用的格式（已经过时）                     |

中国于 1990 年规范了条形码编码标准，规定通用商品条码使用 EAN 标准，运输、医疗卫生等领域条码使用 CODE 39，CODABAR 用于医疗卫生领域。不过，随着技术的发展，该标准也有了许多推荐性（GB/T）的修正，比如 CODE 39 由 CODE 128 做替代，CODABAR 也逐渐再被替换。

条形码的独特的编码方式，使得条码无论是正向扫描还是反向扫描，都可以由扫描器识别出正确的信息。

#### 2.2 二维码

注意，这里我们讨论的二维码主要是应用广泛的 QR Code，实际上二维码不只有 QR Code 一种，还有 PDF_417、AZTEC、DATA_MATRIX 等多种编码标准的二维码。

QR Code 的版本可以通过图案大小和容错等级来进行区分。

按照图案大小，可以分为1～40级，级别越高，图片尺寸越大，可以容纳的信息也就越多。级别 1 是一个 21x21 的矩形，每提高一级，尺寸就会大 4。

| Version |  Scope  |
| :-----: | :-----: |
|    1    |  21x21  |
|    2    |  25x25  |
|    3    |  29x29  |
|   ...   |   ...   |
|   40    | 177x177 |

按照容错等级，每个尺寸的 QR Code 都可以分为四个等级，表示损失原图片后识别到完整信息的能力。

| Error Clooection Level | Max Allowed Loss |
| :--------------------: | :--------------: |
|           L            |        7%        |
|           M            |       15%        |
|           Q            |       25%        |
|           H            |       30%        |

例如，L 等级的二维码表示：“在丢失不多于 7%的情况下可以读取到原来的全部信息”。

### 3. 条形码编码方式

条形码的格式有很多，这里选取商品等广泛使用的 EAN-13 举例说明条形码的编码方式和表示方式。

如图，这是商品 “4908569219689” 的条形码。

![](https://pic.imgdb.cn/item/61c565da2ab3f51d91fa4f83.png)

首先，商品号第 1 - 3 位代表国家，第 4 - 7 位代表生产商，这 7 位数据由 EAN 各国总部负责管理和发放，值得注意的是，国家信息只明确了国家的归属，不能反映出原始生产地。第 8 - 12 位代表商品号码，由生产厂家自行确定，最后一位是校验位，最后一位的校验位有效保证了条形码的安全，只要有一位经过修改，就会和校验位产生冲突。下面介绍检验位生成算法。

拿出商品条码编号的前12位，然后第一位乘 1，第二位乘 3，以此循环算出和。然后对和取 10 的负余数。

以上述的商品举例，首先拿出前 12 位 “490 8569 21968”，可以从 EAN 官网上查询到这是日本企业生产的产品，按照算法计算检验和：
$$
4 \times 1+9 \times 3 + 0 \times 1 + \dots + 6 \times 3 = 151
$$
然后计算检验和模 10 的负余数，易知为 9。所以 EAN_13 条码的最后一位就是 9。

接着，研究 EAN 条形码具体在图像上如何显示，主要要解决的问题是如何才能使扫描仪。请看 EAN 官方给出的 EAN_13 条码的示例。

<img src="https://pic.imgdb.cn/item/61c56f4c2ab3f51d91febfa2.png" style="zoom: 33%;" />

这里商品的数据是 “871 1253 00120 2”。首先我们看到，条形码通过中间，左边和右边的三个定位区域（也叫静态区域）将数据区分为了两个部分。其中左边和右边代表的数据是“101”，中间的部分为“01010”。这三段静态数据的目的是为了让扫描器定位，因为定位数据是中心对称的，所以扫描器不论是正着扫描还是反着扫描，都可以准确定位到二维码。然后我们看到，被截成两段的数据区每段包含6位数据，其中第一位 8 并没有在数据区中有所显示，不过这并不要紧。因为我们有后 12 位数据，由检验位生成算法进行逆运算，就可以唯一确定第一位数据。逆运算过程如下，首先将数据区第一位乘以 3，第二位 乘以 1，按这个循环求出和，然后求该和 模 10 的负余数。因为第一位数据绝对小于 10，所以该结果唯一确定。

对于数字 0-9 的编码，考虑到正读和反读的情况，EAN 对数字有三套编码标准 L、G、R，其中 L 和 G 用于数据区的左侧，表示国家代码和厂商代码，R 用于数据区的右侧，用于表示厂商自定的商品代号。

下面三张图片表示了 L、G、R 的编码方式。

* L 码

<img src="https://pic.imgdb.cn/item/61c5d6212ab3f51d912f6f03.png" style="zoom: 33%;" />

* G 码

<img src="https://pic.imgdb.cn/item/61c5d66a2ab3f51d912f8d2c.png" style="zoom:33%;" />

* R 码

<img src="https://pic.imgdb.cn/item/61c5d6da2ab3f51d912fcaf5.png" style="zoom:33%;" />

对应的二进制如下：

| 数字字符 | L       | G       | R       |
| -------- | ------- | ------- | ------- |
| 0        | 0001101 | 0100111 | 1110010 |
| 1        | 0011001 | 0110011 | 1100110 |
| 2        | 0010011 | 0011011 | 1101100 |
| 3        | 0111101 | 0100001 | 1000010 |
| 4        | 0100011 | 0011101 | 1011100 |
| 5        | 0110001 | 0111001 | 1001110 |
| 6        | 0101111 | 0000101 | 1010000 |
| 7        | 0111011 | 0010001 | 1000100 |
| 8        | 0110111 | 0001001 | 1001000 |
| 9        | 0001011 | 0010111 | 1110100 |

可以观察到，L 码每个数字编码都是以 0 开始，以 1 结束，只有奇数个 1。而 G 码每个数字编码都是以 0 开始，以 1 结束，有偶数次个 1。R 码每个数字编码都是以 1 开始，以 0 结束，有偶数次个 1。

我们还可以观察到，将 R 码的 1 变成 0，0 变成 1，会得到 L 码，也就是说 L 码和 R 码是互补的；同样，将 G 码的最后一位当作第一位逆序读取，会得到该数字的 R 码表示，也就是说 G 码 和 R 码是中心对称的。这两个特性对于方向识别和纠错是很有帮助的。

EAN_13 中规定，正向条码数据区的左侧第一位一定是用 L 码表示，右侧一律用 R 码表示。这样，扫描仪扫描时，当扫描到左边第一位数字上有奇数位 1 时，就可以确定此时扫描仪是在反方向扫描。这时将左边的数字全部用逆码表（即将 1 识别成 0，0 识别成 1）读取，对于此时在右侧，而应该在左侧的，如果有偶数位 1 则直接按照 R 码去读，否则将其按照逆码表读取，最后将读取到的数字逆序排列，就得到了原信息。这样，不论扫描仪是正向还是反向扫描条形码，甚至是受到部分污损的情况下都不会影响到信息的正确读取。也正是因为校验位的设计、对数字的三种不同的编码方式，使得 EAN_13 条形码拥有了稳定性、容错性、高效性，能够成为商业领域中标识商品的国际通行标准。

### 4. 二维码的编码方式

二维码的编码方式，主要有以下几种。
